# R4 Notes 
The following folder structure has been created in order to keep organized the intermediate artifacts generated along the development of the recipe.

* `dataset` folder contains a CSV version of the datataset.
* `onto_sources` folder contains the ontology selected as sources of the branch extraction task.
* `jup_notebooks` folder contains a set jupyter lab notebooks developed to automate the generation of the seed terms needed to perform the branch extraction.
* `seed_files` folder contains (1) a set of files listing the seed terms used to perform branch extraction, and (2) a set of files listing the terms that couldn't be mapped to ontology concepts by means of the jupyter lab notebook.
* `extracted_branches` folder contains the ontology branches obtained from the branch extraction task.

#### Notes:
* The document shows Windows commands.
* The paths shown in this document are relative to the `branch_extraction` Google Drive folder (https://drive.google.com/open?id=1kY_oBDJvs901vNS_NKM7EFoozIXlWK9k). The artifacts were not versioned on the GitHub platform because I haven't the permission to push large files (ontologies).  
* Using Protege or a local deployment of OLS (Recipe 1.3) to show the results. Protege die when the ontology is pretty big.
* I also develop a jupyter notebook using the Zooma Annotator API service, but I couldn't test it because Zooma was died.
* A cleaning of the spreadsheet is needed. I can recognize similarities and erroneous values at the `gender` feature, but I'm not able to do that at - for example - the `disease` column.
* It's neeeded a guideline on how to map the umbrella concepts  - i.e., gender, species, diseases, cell line, etc. - with the root concept of each extracted branch. E.g., `biological sex` is the root concept of the PATO branch, but `gender` is the label of its associated spreadsheet column.
* The NCBITaxon ontology uses different root URI depending the portal which it is downloaded from (i.e., Zooma or NCBO BioPortal). 

## GENDER column
### Get the PATO source ontology
```
wget -Uri http://purl.obolibrary.org/obo/pato.owl -OutFile .\onto_sources\pato.owl
```
### First try
Extract the terms, using the MIREOT method with minimal intermediates.
#### ROBOT command
```
robot extract --method MIREOT ,
--input .\onto_sources\pato.owl ,
--upper-term "PATO:0000047" ,
--lower-term "PATO:0000384" ,
--lower-term "PATO:0000383" ,
--intermediates minimal ,
--output .\extracted_branches\gender_branch_1.owl
```
#### Branch extracted
Available at `./extracted_branches/gender_branch_1.owl`

### Second try
Following @Danielle suggestion _"get the full biological sex branch"_
#### ROBOT command
```
robot extract --method MIREOT ,
--input .\onto_sources\pato.owl ,
--branch-from-term "PATO:0000047" ,
--output .\extracted_branches\gender_branch_2.owl
```
#### Branch extracted
Available at `./extracted_branches/gender_branch_2.owl`

### Third try
Using the seeds file `gender_seeds.txt` which is automatically generated by running the `bioportal-annotator` jupyter notebook.
Extract the terms, using the MIREOT method with the automatically extracted terms as lower limit.
#### ROBOT command
```
robot extract --method MIREOT ,
--input .\onto_sources\pato.owl ,
--lower-terms .\seed_files\gender_seeds.txt ,
--output .\extracted_branches\gender_branch_3.owl
```
#### Branch extracted
Available at `./extracted_branches/gender_branch_3.owl`

## SPECIES column
### Get the NCBITAXON source ontology
```
wget -Uri http://purl.obolibrary.org/obo/ncbitaxon.owl -OutFile .\onto_sources\ncbitaxon.owl
```
### First try
Extract the terms, using the MIREOT method with minimal intermediates.
#### ROBOT command
```
robot extract --method MIREOT ,
--input .\onto_sources\ncbitaxon.owl ,
--upper-term "NCBITaxon:131567" ,
--lower-term "NCBITaxon:9606" ,
--lower-term "NCBITaxon:10090" ,
--lower-term "NCBITaxon:10116" ,
--intermediates minimal ,
--output .\extracted_branches\species_branch_1.owl
```
:bulb: *Very large ontology. It is needed to increase the Java Heap space.*
```
java -Xmx12000m -jar [FULLPATH TO ROBOT JAR FILE] extract --method MIREOT ,
--input .\onto_sources\ncbitaxon.owl ,
--upper-term "NCBITaxon:131567" ,
--lower-term "NCBITaxon:9606" ,
--lower-term "NCBITaxon:10090" ,
--lower-term "NCBITaxon:10116" ,
--intermediates minimal ,
--output .\extracted_branches\species_branch_1.owl
```
#### Branch extracted
Available at `.\extracted_branches\species_branch_1.owl`

### Second try
Using the seeds file `species_seeds.txt` which is automatically generated by running the `bioportal-annotator` jupyter notebook. 
Extract the terms, using the MIREOT method with the automatically extracted terms.
#### ROBOT command

```
java -Xmx12000m -jar [FULLPATH TO ROBOT JAR FILE] extract --method MIREOT ,
--input .\onto_sources\ncbitaxon.owl ,
--lower-terms .\seed_files\species_seeds.txt
--intermediates minimal ,
--output .\extracted_branches\species_branch_1.owl
```
#### Branch extracted
Weird results here.
The obtained ontology - available at `.\extracted_branches\species_branch_2.owl` - is empty.
By inspecting the `species_seeds.txt` file, the NCBO BioPortal, and the OBO Foundry portal, it can be noted that there are two versions of the same ontology. An OBO version with the root URI http://purl.obolibrary.org/obo/, and a NCBO version with the root URI http://purl.bioontology.org/ontology/NCBITAXON/. 
Given that the `bioportal-annotator` notebook is based on the NCBO BioPortal Annotator API service, the annotations serialized in the `species_seeds.txt` file use the NCBO version's URI. But the source ontology used to perform the branch extraction has been downloaded from the OLS portal, and it uses the NCBO version's URI. In consequence, the branch extraction task get an empty ontology as a result. 

## DISEASE column
### Get the MONDO source ontology
```
wget -Uri http://purl.obolibrary.org/obo/mondo.owl -OutFile .\onto_sources\mondo.owl
```
### First try
Extract the full `disease or disorder` MONDO's branch, using the SLME TOP method.
#### ROBOT command  
```
robot extract --method TOP ,
--input .\onto_sources\mondo.owl ,
--term "MONDO:0000001" ,
--output .\extracted_branches\disease_branch_1.owl
```
#### Branch extracted
Weird results obtained!
Available at `.\extracted_branches\disease_branch_1.owl`

### Second try
Extract the terms, using the MIREOT method with minimal intermediates
#### ROBOT command
```
robot extract --method MIREOT ,
--input .\onto_sources\mondo.owl ,
--branch-from-term "MONDO:0000001" ,
--intermediates minimal ,
--output .\extracted_branches\disease_branch_2.owl
```
#### Branch extracted
Expected results this time.
Available at `.\extracted_branches\disease_branch_2.owl`

### Third try
Following @Danielle suggestion, using seed file provided by her and available at `.\seed_files\disease_seeds_danielle.txt`.
Extract the terms, using the BOT seed feeded method.
#### ROBOT command
```
robot extract --method BOT ,
--input .\onto_sources\mondo.owl ,
--term-file .\seed_files\disease_seeds_danielle.txt ,
--output .\extracted_branches\disease_branch_3.owl
```
#### Branch extracted
Interesting results this time.
Available at `.\extracted_branches\disease_branch_3.owl`

### Fourth try
Using the seeds file `disease_seeds.txt` which is automatically generated by running the `bioportal-annotator` jupyter notebook. 
Extract the terms, using the BOT method with the automatically extracted terms.
#### ROBOT command
```
robot extract --method BOT ,
--input .\onto_sources\mondo.owl ,
--term-file .\seed_files\disease_seeds.txt ,
--output .\extracted_branches\disease_branch_4.owl
```
#### Branch extracted
Available at `.\extracted_branches\disease_branch_4.owl`

## TISSUE column
### Get the MONDO source ontology
```
wget -Uri http://purl.obolibrary.org/obo/uberon.owl -OutFile .\onto_sources\uberon.owl
```
### First try
Extract the seed terms automatically obtained by means of the `bioportal-annotator` jupyter notebook, using the SLME BOT method.

#### ROBOT command  
```
robot extract --method BOT ,
--input .\onto_sources\uberon.owl ,
--term-file .\seed_files\tissue_seeds.txt ,
--output .\extracted_branches\tissue_branch_1.owl
```
#### Branch extracted
Available at `.\extracted_branches\tissue_branch_1.owl`

## CELL column
### Get the MONDO source ontology
```
wget -Uri http://purl.obolibrary.org/obo/clo.owl -OutFile .\onto_sources\clo.owl
```
### First try
Extract the seed terms automatically obtained by means of the `bioportal-annotator` jupyter notebook, using the MIREOT method.
#### ROBOT command  
```
robot extract --method MIREOT ,
--input .\onto_sources\clo.owl ,
--lower-terms .\seed_files\cell_seeds.txt ,
--intermediates minimal ,
--output .\extracted_branches\cell_branch_1.owl
```
:bulb: *Very large ontology. It is needed to increase the Java Heap space.*
```
java -Xmx1250m -jar [FULLPATH TO ROBOT JAR FILE] extract --method MIREOT ,
--input .\onto_sources\clo.owl ,
--lower-terms .\seed_files\cell_seeds.txt ,
--intermediates minimal ,
--output .\extracted_branches\cell_branch_1.owl
```
#### Branch extracted
Available at `.\extracted_branches\cell_branch_1.owl`



